<!DOCTYPE html>
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>ğŸ“… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©</title>
  <style>
    body{
      font-family: "Segoe UI", Tahoma, sans-serif;
      background: linear-gradient(135deg,#f2f6fb,#e7eef6);
      color:#2b3440; margin:0; padding:32px; text-align:center;
    }
    h1{margin:0 0 14px; color:#34495e}
    .hint{color:#6b7b8c; font-size:14px; margin-bottom:24px}
    #events{display:grid; grid-template-columns:repeat(auto-fit,minmax(260px,1fr)); gap:16px; max-width:1000px; margin:0 auto}
    .card{
      background:#fff; border:1px solid #e5eef6; border-radius:14px; padding:18px;
      box-shadow:0 8px 24px rgba(0,0,0,.06);
      transition:transform .15s ease, box-shadow .15s ease;
    }
    .card:hover{transform:translateY(-3px); box-shadow:0 12px 28px rgba(0,0,0,.08)}
    .name{font-weight:800; color:#264b63; margin:0 0 8px}
    .row{margin:4px 0; color:#0e7aa6; font-weight:600}
    .tag{display:inline-block; font-size:12px; color:#8a99a8; margin-top:8px}
    .personal{border-inline-start:4px solid #ff9800; padding-inline-start:14px}
    .loading{opacity:.6}
  </style>
</head>
<body>
  <h1>ğŸ“… Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª Ø§Ù„Ø³Ù†ÙˆÙŠØ©</h1>
  <div class="hint">ØªÙØ¹Ø±ÙØ¶ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ (Ù…ÙŠÙ„Ø§Ø¯ÙŠ + Ù‡Ø¬Ø±ÙŠ) Ø¨Ù…Ø¸Ù‡Ø± Ù‡Ø§Ø¯Ø¦.</div>
  <div id="events" class="loading">Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„â€¦</div>

<script>
(async function(){
  const box = document.getElementById('events');
  const today = new Date();

  // â€”â€”â€” Ù…Ø³Ø§Ø¹Ø¯Ø§Øª â€”â€”â€”
  const dd = n => String(n).padStart(2,'0');
  const toDMY = (date) => `${dd(date.getDate())}-${dd(date.getMonth()+1)}-${date.getFullYear()}`;
  const parseDMY = (dmy) => {
    // "dd-mm-yyyy" -> Date (Ù…Ø­Ù„ÙŠ)
    const [d,m,y] = dmy.split('-').map(Number);
    return new Date(y, m-1, d);
  };
  const formatAr = (date) => date.toLocaleDateString("ar-EG", { day:"2-digit", month:"2-digit", year:"numeric" });

  async function gToHStr(date){
    const dmy = toDMY(date); // dd-mm-yyyy
    try{
      const r = await fetch(`https://api.aladhan.com/v1/gToH?date=${dmy}`);
      const j = await r.json();
      const h = j.data.hijri;
      return `${h.day} ${h.month.ar} ${h.year}`;
    }catch{ return "ØªØ¹Ø°Ù‘Ø± Ø§Ù„Ø¬Ù„Ø¨"; }
  }

  async function hToGDate(hDay, hMonth, hYear){
    // ÙŠØ±Ø¬Ø¹ Date Ù…ÙŠÙ„Ø§Ø¯ÙŠ Ù„ØªØ§Ø±ÙŠØ® Ù‡Ø¬Ø±ÙŠ Ù…ÙØ¹Ø·Ù‰
    const dmy = `${dd(hDay)}-${dd(hMonth)}-${hYear}`;
    const r = await fetch(`https://api.aladhan.com/v1/hToG?date=${dmy}`);
    const j = await r.json();
    // Ø§Ù„ØµÙŠØºØ© ØªÙƒÙˆÙ† "dd-mm-yyyy"
    return parseDMY(j.data.gregorian.date);
  }

  async function getCurrentHijriYear(){
    const r = await fetch(`https://api.aladhan.com/v1/gToH?date=${toDMY(today)}`);
    const j = await r.json();
    return parseInt(j.data.hijri.year, 10);
  }

  // ÙŠØ¹Ø·ÙŠ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù… Ù„Ù…Ù†Ø§Ø³Ø¨Ø© Ù‡Ø¬Ø±ÙŠÙ‘Ø© (ÙŠØ¬Ø±Ù‘Ø¨ Ø³Ù†Ø© Ù‡Ø¬Ø±ÙŠØ© Ø­Ø§Ù„ÙŠØ© + Ø§Ù„ØªØ§Ù„ÙŠØ©)
  async function nextIslamicOccur(hDay, hMonth){
    const hYear = await getCurrentHijriYear();
    const g1 = await hToGDate(hDay, hMonth, hYear);
    if (g1 >= stripTime(today)) return g1;
    const g2 = await hToGDate(hDay, hMonth, hYear + 1);
    return g2;
  }

  function stripTime(d){ return new Date(d.getFullYear(), d.getMonth(), d.getDate()); }

  // Ù…Ù†Ø§Ø³Ø¨Ø© Ø´Ø®ØµÙŠØ© (Ù…ÙŠÙ„Ø§Ø¯ÙŠ): Ø±Ø¬Ù‘Ø¹ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø¨Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ø£Ùˆ Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©
  function nextGregorianMMDD(mm_dd){
    const [m,d] = mm_dd.split('-').map(Number);
    let g = new Date(today.getFullYear(), m-1, d);
    if (stripTime(g) < stripTime(today)) g.setFullYear(g.getFullYear()+1);
    return g;
  }

  function cardHTML({name, gStr, hStr, personal}){
    return `
      <div class="card ${personal ? 'personal':''}">
        <div class="name">${name}</div>
        <div class="row">ğŸ“† Ù…ÙŠÙ„Ø§Ø¯ÙŠ: ${gStr}</div>
        <div class="row">ğŸ•Œ Ù‡Ø¬Ø±ÙŠ: ${hStr}</div>
        ${personal ? `<div class="tag">Ù…Ù†Ø§Ø³Ø¨Ø© Ø´Ø®ØµÙŠØ©</div>` : ``}
      </div>
    `;
  }

  // â€”â€”â€” Ø§Ù„Ù…Ù†Ø§Ø³Ø¨Ø§Øª â€”â€”â€”
  // Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© (Ù‡Ø¬Ø±ÙŠ Ø«Ø§Ø¨Øª): 1 Ø±Ù…Ø¶Ø§Ù†ØŒ 1 Ø´ÙˆØ§Ù„ (Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±)ØŒ 10 Ø°Ùˆ Ø§Ù„Ø­Ø¬Ø© (Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰)ØŒ 1 Ù…Ø­Ø±Ù… (Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©)
  const islamic = [
    { name:"ğŸŒ™ Ø¨Ø¯Ø§ÙŠØ© Ø±Ù…Ø¶Ø§Ù†", hDay:1,  hMonth:9  },
    { name:"ğŸŠ Ø¹ÙŠØ¯ Ø§Ù„ÙØ·Ø±",   hDay:1,  hMonth:10 },
    { name:"ğŸ•‹ Ø¹ÙŠØ¯ Ø§Ù„Ø£Ø¶Ø­Ù‰",   hDay:10, hMonth:12 },
    { name:"ğŸ‰ Ø±Ø£Ø³ Ø§Ù„Ø³Ù†Ø© Ø§Ù„Ù‡Ø¬Ø±ÙŠØ©", hDay:1, hMonth:1 }
  ];

  // Ø§Ù„Ø´Ø®ØµÙŠØ© (Ù…ÙŠÙ„Ø§Ø¯ÙŠ ÙŠØªÙƒØ±Ø± Ø³Ù†ÙˆÙŠØ§Ù‹):
  const personal = [
    { name:"ğŸ‚ Ø¹ÙŠØ¯ Ù…ÙŠÙ„Ø§Ø¯ Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ù†", mmdd:"09-15" }, // 15.09 (Ø­Ø³Ø¨ Ø·Ù„Ø¨Ùƒ: 15.09.1999 â†’ ØªØªÙƒØ±Ø± Ø³Ù†ÙˆÙŠØ§Ù‹)
    { name:"ğŸ“ Ø°ÙƒØ±Ù‰ Ø§Ù„ØªØ®Ø±Ù‘Ø¬",         mmdd:"11-27" }  // 27.11.2024 â†’ ØªØªÙƒØ±Ø± Ø³Ù†ÙˆÙŠØ§Ù‹
  ];

  try{
    const cards = [];

    // Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ© â†’ Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø¨Ø¯Ù‚Ø©
    for (const ev of islamic){
      const gDate = await nextIslamicOccur(ev.hDay, ev.hMonth);
      const gStr = formatAr(gDate);
      const hStr = await gToHStr(gDate); // Ù†Ù…Ø· Ø¹Ø±Ø¨ÙŠ Ø¬Ù…ÙŠÙ„ Ù…Ø«Ù„: "1 Ø±Ù…Ø¶Ø§Ù† 1446"
      cards.push(cardHTML({name:ev.name, gStr, hStr, personal:false}));
    }

    // Ø§Ù„Ø´Ø®ØµÙŠØ© â†’ Ø§Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„Ù‚Ø§Ø¯Ù… Ø³Ù†ÙˆÙŠØ§Ù‹
    for (const ev of personal){
      const gDate = nextGregorianMMDD(ev.mmdd);
      const gStr = formatAr(gDate);
      const hStr = await gToHStr(gDate);
      cards.push(cardHTML({name:ev.name, gStr, hStr, personal:true}));
    }

    box.classList.remove('loading');
    box.innerHTML = cards.join('');
  }catch(e){
    box.innerHTML = "<div class='card'>ØªØ¹Ø°Ù‘Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ®. ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª Ø«Ù… Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©.</div>";
  }
})();
</script>
</body>
</html>
